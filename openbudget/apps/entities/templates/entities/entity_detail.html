{% extends 'entities/entity_list.html' %}
{% load i18n interactions %}
{% load url from future %}

{% block title %}
{{ object.name }}
{% endblock title %}

{% block content %}
{% star object user %}
<p>
    <a href="{% url 'entity_list' %}">
        {% trans 'Back to all geopols' %}
    </a>
</p>

<section>
    <h2>
        {% trans 'About' %} {{ object.name }}
    </h2>
    {% if object.ultimate_parent == object %}
    {% else %}
    <p>
        {{ object.name }} {% trans 'is one of ' %} {{ object.division.count }} {{ object.division.name }} {% trans 'entities' %} {% trans 'in ' %} <a href="{% url 'entity_detail' object.ultimate_parent.slug %}">{{ object.ultimate_parent }}</a>.
    </p>
    {% endif %}

    <div>
        {{ object.description }}
    </div>
</section>

<section>
    <h2>
        {% if object.ultimate_parent == object %}
        {% trans 'Budgeting entities of' %} {{ object.name }}
        {% else %}
        {% trans 'Related' %} {% trans 'budgeting entities' %}
        {% endif %}
    </h2>
    <div>
        {% if not object.related_entities %}
        <p>
            {{ object.name }} {% trans 'has no related entities that declare budgets' %}.</a>
        </p>
        {% else %}
        <p>
            {% trans 'We have the following related entities with budgets in the system' %}.
        </p>
        {% for related_entity in object.related_entities %}
        <a href="{% url 'entity_detail' related_entity.slug %}">
            {{ related_entity.name }}
        </a> ({{ related_entity.division.name }})
        <br />
        {% endfor %}
        {% endif %}
    </div>
</section>

<section>
    <h2>
        {% trans 'Budgets and Actuals' %}
    </h2>

    {% if not object.division.has_budgets %}
    <p>
        <strong>{{ object.name }}</strong> {% trans 'is a' %} {{ object.division.name }} {% trans 'of' %} {{ object.division.domain }}, {% trans 'and therefore does not declare budgets. It serves a purely administrative function.' %}
    </p>
    {% else %}

    {% if not object.budgets and not object.actuals %}
    <p>
        {% trans 'There are no Budgets or Actuals for this entity' %}.
    </p>
    {% else %}
    <div>
        <h3>
            {% trans 'Budgets available' %}...
        </h3>
        {% if not object.budgets %}
        <p>
            {% trans 'There are no Budgets this entity' %}.
        </p>
        {% else %}
        <ul>
        {% for budget in object.budgets %}
        <li>
            <a href="{% url 'budget_detail' budget.uuid %}">
                {{ budget.period }}
            </a>
        </li>
        {% endfor %}
        </ul>
        {% endif %}
    </div>
    <div>
        <h3>
            {% trans 'Actuals available' %}...
        </h3>
        {% if not object.actuals %}
        <p>
            {% trans 'There are no Actuals this entity' %}.
        </p>
        {% else %}
        <ul>
        {% for actual in object.actuals %}
        <li>
            <a href="{% url 'actual_detail' actual.uuid %}">
                {{ actual.period }} (Variance: {% if actual.has_budgets %}{{ actual.variance }}%{% endif %})
            </a>
        </li>
        {% endfor %}
        </ul>
        {% endif %}
    </div>
    {% endif %}

    {% endif %}
</section>

<section>
    {% include 'interactions/partials/_discussion.html' %}
</section>
{% endblock content %}
